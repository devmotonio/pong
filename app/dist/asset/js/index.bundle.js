(()=>{"use strict";class t{constructor(t,e,i,s){this.width=t,this.height=e,this.x1=i,this.y1=s,this.top={point:this.y1,start:this.x1,end:this.x2},this.right={point:this.x2,start:this.y1,end:this.y2},this.bottom={point:this.y2,start:this.x1,end:this.x2},this.left={point:this.x1,start:this.y1,end:this.y2}}get x2(){return this.x1+this.width}get y2(){return this.y1+this.height}setPosition(t,e){this.x1=t,this.y1=e}includesCord(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2}includesArea(t){return this.includesCord(t.x1,t.y1)||this.includesCord(t.x1,t.y2)||this.includesCord(t.x2,t.y1)||this.includesCord(t.x2,t.y2)}}class e extends t{constructor(t,e,i,s,h,n){super(t,e,i,s),this.speed=10,this.direction=0,this.enabled=!1,this.top=h,this.bottom=n}moveUp(){this.direction=-this.speed}moveDown(){this.direction=this.speed}getSpeed(){return this.speed}setSpeed(t){this.speed+=t}move(){this.enabled&&(this.y1+=this.direction,this.y1<this.top&&(this.y1=this.top),this.y2>this.bottom&&(this.y1=this.bottom-this.height))}stop(){this.direction=0}reset(){this.y1=this.top}animate(t){this.move(),t.fillStyle="#fff",t.fillRect(this.x1,this.y1,this.width,this.height)}}class i extends t{constructor(t,e,i,s,h){super(t,e,i,s),this.screen=h,this.speedMin=4,this.speedStep=.5,this.hitSound=new Audio("./asset/audio/hit.mp3"),this.init()}init(){this.speedX=Math.floor(6*Math.random())+this.speedMin,this.speedY=Math.floor(6*Math.random())+this.speedMin,this.directionX=Math.random()<.5?-1:1,this.directionY=Math.random()<.5?-1:1}setSpeedY(t=this.speedStep){this.speedY+t>=this.speedMin&&(this.speedY+=t)}setSpeedX(t=this.speedStep){this.speedX+t>=this.speedMin&&(this.speedX+=t)}getSpeedX(){return this.speedX}getSpeedY(){return this.speedY}hitPaddle(){this.hitSound.play(),this.setSpeedX(),this.setSpeedY(-this.speedStep),this.directionX=-this.directionX}hitBorder(){this.hitSound.play(),this.setSpeedY(),this.directionY=-this.directionY}checkHitTop(){this.directionY<0&&this.y1<this.screen.y1&&this.hitBorder()}checkHitRight(){return this.directionX>0&&this.x1>=this.screen.x2}checkHitBottom(){this.directionY>0&&this.y2>this.screen.y2&&this.hitBorder()}checkHitLeft(){return this.directionX<0&&this.x2<=this.screen.x1}move(){this.x1+=this.speedX*this.directionX,this.y1+=this.speedY*this.directionY}reset(){this.x1=this.screen.width/2,this.y1=this.screen.height/2,this.init()}animate(t){this.move(),t.fillStyle="#f00",t.fillRect(this.x1,this.y1,this.width,this.height)}}class s{constructor(t){document.addEventListener("keydown",(e=>{switch(e.keyCode){case 38:e.preventDefault(),t.paddleL.moveUp(),t.paddleR.moveUp();break;case 40:e.preventDefault(),t.paddleL.moveDown(),t.paddleR.moveDown()}})),document.addEventListener("keyup",(e=>{switch(e.keyCode){case 38:e.preventDefault(),t.paddleL.direction<0&&t.paddleL.stop(),t.paddleR.direction<0&&t.paddleR.stop();break;case 40:e.preventDefault(),t.paddleL.direction>0&&t.paddleL.stop(),t.paddleR.direction>0&&t.paddleR.stop()}})),t.canvas.addEventListener("click",(e=>{t.isPlay||t.play()}))}}(new class{constructor(){let e=Math.floor(.7*window.visualViewport.height);this.canvas=document.getElementById("game_screen"),this.ctx=this.canvas.getContext("2d"),this.rank=[],this.speedX=0,this.speedY=0,this.directionX=0,this.directionY=0,this.isPlay=!1,this.point=0,this.canvas.height=e,this.canvas.width=Math.floor(2.5*e)<window.visualViewport.width?Math.floor(2.5*e):Math.floor(.8*window.visualViewport.width),this.gameScreen=new t(Math.floor(.8*this.canvas.width),this.canvas.height,0,0),this.rankScreen=new t(Math.floor(.2*this.canvas.width),this.canvas.height,this.gameScreen.x2,0)}init(){let t=Math.floor(.03*this.gameScreen.height),s=Math.floor(t/3),h=Math.floor(this.gameScreen.width/2),n=Math.floor(this.gameScreen.height/2),a=5*t,r=s,d=this.gameScreen.height-s,c=s,l=this.gameScreen.width-t-s;this.ball=new i(t,t,h,n,this.gameScreen),this.paddleL=new e(t,a,c,r,r,d),this.paddleR=new e(t,a,l,r,r,d),this.gameObjects=[this.ball,this.paddleL,this.paddleR]}reset(){this.rank.includes(this.point)||(this.rank.push(this.point),console.log("game.1",this.rank),this.rank.sort((function(t,e){return t-e})),console.log("game.2",this.rank),this.rank.reverse(),console.log("game.3",this.rank),this.rank.length>5&&this.rank.pop(),localStorage.setItem("rank",this.rank.join(","))),this.point=0,this.ball.reset(),this.paddleL.reset(),this.paddleR.reset()}animate(){this.animateGameScreen(),this.animateRankScreen()}animateGameScreen(){this.ctx.fillStyle="#000",this.ctx.fillRect(this.gameScreen.x1,this.gameScreen.y1,this.gameScreen.width,this.gameScreen.height),this.ball.directionX>0?(this.paddleL.enabled=!1,this.paddleR.enabled=!0):(this.paddleL.enabled=!0,this.paddleR.enabled=!1),(this.ball.checkHitRight()||this.ball.checkHitLeft())&&this.reset(),this.ball.checkHitTop(),this.ball.checkHitBottom(),this.checkHitPaddle(this.paddleL,this.ball),this.checkHitPaddle(this.paddleR,this.ball),this.gameObjects.forEach((t=>t.animate(this.ctx)))}animateRankScreen(){let t=Math.floor(.06*this.rankScreen.height),e=Math.floor(.8*t);this.ctx.fillStyle="#333",this.ctx.fillRect(this.rankScreen.x1,this.rankScreen.y1,this.rankScreen.width,this.rankScreen.height),this.ctx.fillStyle="#fff",this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=`${t}px sans-serif`,this.ctx.fillText("POINTS",this.rankScreen.x1+this.rankScreen.width/2,e),this.ctx.fillText(this.point,this.rankScreen.x1+this.rankScreen.width/2,e+t),this.ctx.fillText("RANK",this.rankScreen.x1+this.rankScreen.width/2,Math.floor(2*e+2*t)),this.rank.forEach(((i,s)=>{this.ctx.fillText(i,this.rankScreen.x1+this.rankScreen.width/2,Math.floor(2*e+3*t)+t*s)})),this.ctx.fillStyle="#f00",this.ctx.fillText("Use keys",this.rankScreen.x1+this.rankScreen.width/2,Math.floor(2*e+9*t)),this.ctx.fillText("↑ and ↓",this.rankScreen.x1+this.rankScreen.width/2,Math.floor(3*e+10*t)),this.ctx.fillText("To play",this.rankScreen.x1+this.rankScreen.width/2,Math.floor(4*e+11*t))}checkHitPaddle(t,e){t.enabled&&t.includesArea(e)&&(e.hitPaddle(),this.point++,t.enabled=!1)}gameLoop(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.animate(),requestAnimationFrame((t=>{this.gameLoop()}))}play(){this.isPlay=!0,this.init(),this.gameLoop()}start(){let t=localStorage.getItem("rank"),e=Math.floor(.1*this.canvas.height);this.rank=null==t||""==t?this.rank:t.split(",").map((t=>isNaN(parseInt(t))?0:parseInt(t))),this.inputHandler=new s(this),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#f00",this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=`${e}px sans-serif`,this.ctx.fillText("CLICK ANYWHERE TO START",Math.floor(this.canvas.width/2),Math.floor(this.canvas.height/2))}}).start()})();